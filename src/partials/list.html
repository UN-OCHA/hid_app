<div class="masthead row">
  <div class="col-xs-12 col-sm-8 col-sm-offset-4 col-md-9 col-md-offset-3 pull-right">
    <h2 class="heading-contact-list">{{location}} <span translate>Contact List</span> <small>(<span translate>Contacts</span> {{queryCount}})</small></h2>
  </div>
</div>

<div class="main row page-list" ng-class="{'show-options': sidebarOptions}">
  <div class="active-contacts col-xs-12 col-sm-8 col-md-9 pull-right">
    <browser-alert></browser-alert>

    <form class="search-form">
      <div class="form-group">
        <label class="control-label element-invisible" for="text" translate>Search</label>
        <input class="form-control contact-search" type="search" name="text"
               placeholder="{{'Search by name, title, or organization'|translate}}" ng-model="query.text"/>
      </div>

      <div class="form-group">
        <input class="btn btn-primary btn-md element-invisible" ng-click="submitSearch()" type="submit"
               value="{{'Search'|translate}}"/>
      </div>
    </form>

    <ul class="list-group" cg-busy="contactsPromise">
      <li class="profile-item list-group-item" ng-repeat="contact in contacts | orderBy: ['nameGiven', 'nameFamily']">
        <div class="row">
          <div class="contact-item contact-item--name col-xs-12 col-md-3" >
            <a href="#/contact/{{contact._id}}">{{contact.nameGiven}} {{contact.nameFamily}}</a>
            <div class="contact-item__markers" ng-if="contact.keyContact || contact._profile.verified">
              <div class="contact-item__key-contact" title="Key Contact" ng-if="contact.keyContact">*</div>
              <span class="contact-item__verified" title="Verified" ng-if="contact._profile.verified"><i class="fa fa-check-circle"></i></span>
            </div>
          </div>
          <div class="contact-item contact-item--jobtitle col-xs-7 col-md-3"><span title="{{contact.jobtitle}}">{{contact.jobtitle}}</span></div>
          <div class="contact-item contact-item--organization col-xs-5" ng-class="(contact.bundle.length) ? 'col-md-3' : 'col-md-6'"><span title="{{contact.organization[0].name}}">{{contact.organization[0].name}}</span></div>
          <div class="contact-item contact-item--bundle col-md-3" ng-hide="!contact.bundle.length"><span title="{{contact.bundle.join(', ')}}">{{contact.bundle.join(', ')}}</span></div>
        </div>
      </li>
    </ul>

    <div class="panel panel-danger" ng-if="contacts.length == 0 && contactsCreated">
      <div class="panel-heading"><em translate>No contacts found</em></div>
    </div>

    <div class="contact-loader" ng-class="{'list-complete': listComplete || !contacts.length}" in-view="loadMoreContacts($inview, $inviewpart)" in-view-options="{debounce: 1000}" cg-busy="{promise:contactsPromise, message:'', backdrop:false, templateUrl:spinTpl, minDuration:1400, wrapperClass:'list-spinner'}"></div>

    <div class="contact-count" ng-show="contactsCount">{{contactsCount}} / {{queryCount}}</div>
  </div>

  <div class="sidebar-left">
    <div ng-show="!isRouteLoading">
      <div class="visible-xs">
        <div class="bottom-fixed-btn" role="presentation">
          <a href ng-click="sidebarOptions = !sidebarOptions"><div class="bottom-fixed-btn__arrow"></div><span translate>Contact List Filters</span></a>
        </div>
      </div>
    </div>

    <div class="actions-wrapper col-xs-12 col-sm-4 col-md-3">
      <form class="filter-form actions">

        <div class="form-group" ng-show="bundles.length">
          <label class="control-label element-invisible" for="bundle" translate>Group</label>
          <ui-select ng-model="query.bundle" theme="selectize" class="form-control"  name="bundle" on-select="onSelect($item, 'bundle')">
            <ui-select-match placeholder="{{'Group'|translate}}">{{$select.selected.value}}</ui-select-match>
            <ui-select-choices ng-class="{'not-empty': bundles.length}" repeat="bundle.value as bundle in bundles | orderBy:'value' | filter: $select.search">
              <div ng-class="{default: !bundle.value.length}" ng-bind-html="bundle.alt || (bundle.value | highlight: $select.search)"></div>
            </ui-select-choices>
          </ui-select>
        </div>

        <div class="form-group">
          <label class="control-label element-invisible" for="organization" translate>Organization</label>
          <ui-select
            class="form-control"
            name="organization"
            ng-model="query['organization.name']"
            theme="selectize"
            reset-search-input="true"
            on-select="onSelect($item, 'organization.name')">
              <ui-select-match placeholder="{{'Organization'|translate}}">{{$select.selected.name}}</ui-select-match>
              <ui-select-choices ng-class="{'not-empty': organizations.length}" repeat="org.name as org in organizations | orderBy:'name'" refresh="refreshOrganization($select, 2)" refresh-delay="200">
                <div ng-class="{default: !organizations.name.length}" ng-bind-html="org.alt || (org.name | highlight: $select.search) "></div>
              </ui-select-choices>
          </ui-select>
        </div>

        <div class="form-group">
          <label class="control-label element-invisible" for="protectedRole" translate>Role</label>
          <ui-select ng-model="query.protectedRoles" theme="selectize" class="form-control"  name="protectedRole" on-select="onSelect($item, 'protectedRoles')">
            <ui-select-match placeholder="{{'Role'|translate}}">{{$select.selected.name}}</ui-select-match>
            <ui-select-choices ng-class="{'not-empty': protectedRoles.length}" repeat="protectedRole.id as protectedRole in protectedRoles | orderBy:'name' | filter: $select.search">
              <div ng-class="{default: !protectedRole.name.length}" ng-bind-html="protectedRole.alt || (protectedRole.name | highlight: $select.search)"></div>
            </ui-select-choices>
          </ui-select>
        </div>

        <div class="location-filters">
          <div class="form-group" ng-if="locationId === 'global'">
            <label class="control-label element-invisible" for="country" translate>Country</label>
            <ui-select ng-model="query['address.country']" theme="selectize" class="form-control"  name="country" on-select="onSelect($item, 'address.country')">
              <ui-select-match placeholder="{{'Country'|translate}}">{{$select.selected.name || $select.selected.alt}}</ui-select-match>
              <ui-select-choices ng-class="{'not-empty': countries.length}" repeat="country.name as country in countries | orderBy:'name' | filter: $select.search">
                <div ng-class="{default: !country.name.length}" ng-bind-html="country.alt || (country.name | highlight: $select.search)"></div>
              </ui-select-choices>
            </ui-select>
          </div>

          <div class="form-group" ng-show="locationId !== 'global' && regions.length">
            <label class="control-label element-invisible" for="region" translate>Region</label>
            <ui-select ng-model="query['address.administrative_area']" theme="selectize" class="form-control"  name="region" on-select="onSelect($item, 'address.administrative_area')">
              <ui-select-match placeholder="{{'Region'|translate}}">{{$select.selected.name || regions.selected.alt}}</ui-select-match>
              <ui-select-choices ng-class="{'not-empty': regions.length}" repeat="region.name as region in regions | orderBy:'name' | filter: $select.search">
                <div ng-class="{default: !region.name.length}" ng-bind-html="region.alt || (region.name | highlight: $select.search)"></div>
              </ui-select-choices>
            </ui-select>
          </div>

          <div class="form-group" ng-show="locationId !== 'global' && localities.length">
            <label class="control-label element-invisible" for="locality" translate>Locality</label>
            <ui-select ng-model="query['address.locality']" theme="selectize" class="form-control"  name="locality" on-select="onSelect($item, 'address.locality')">
              <ui-select-match placeholder="{{'Locality'|translate}}">{{$select.selected.name || $select.selected.alt}}</ui-select-match>
              <ui-select-choices ng-class="{'not-empty': locality.length}" repeat="locality.name as locality in localities | orderBy:'name' | filter: $select.search">
                <div ng-class="{default: !locality.name.length}" ng-bind-html="locality.alt || (locality.name | highlight: $select.search)"></div>
              </ui-select-choices>
            </ui-select>
          </div>

        </div>

        <div class="divider"></div>

        <div class="form-group">
          <label class="control-label" for="verified"><i class="fa fa-check-circle"></i> <span translate>Verified User</span> <input type="checkbox" name="verified" ng-model="query.verified" /></label>

        </div>

        <div class="form-group" ng-if="query.locationId">
          <label class="control-label" for="keyContact"><span class="contact-item__key-contact key-contact-filter-use">*</span> <span translate>Key Contact</span> <input type="checkbox" name="keyContact" ng-model="query.keyContact" /></label>
        </div>

        <div class="divider"></div>

        <div class="form-group">
          <input class="btn btn-primary btn-lg btn-block" type="submit" ng-click="submitSearch()" value="{{'Search'|translate}}"/>
          <input class="btn btn-warning btn-lg btn-block" type="button" ng-click="exportSearch()" ng-show="userCanExportContacts" value="{{'Export Results'|translate}}"/>
          <a class="btn btn-warning btn-lg btn-block" type="button" target="_blank" ng-href="{{printUrl}}" ng-show="userCanExportContacts" translate>Veiw Printable</a>
          <input class="btn btn-warning btn-lg btn-block" type="button" ng-click="resetSearch()" value="{{'Reset Filters'|translate}}"/>
        </div>
      </form>
    </div>
  </div>
</div>

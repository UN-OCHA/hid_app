<div class="masthead">
  <h2 translate>Humanitarian ID</h2>
</div>

<div ng-show="!isRouteLoading" class="">
  <div class="active-countries" ng-hide="selectedPlace.length">
    <div class="back-link"><a class="btn btn-warning btn-sm" href="#/dashboard"><i class="fa fa-arrow-circle-left"></i> <span translate>Back</span></a></div>
    <h3 translate>Select a country</h3>
    <ul class="active-countries-container list-group">
      <li class="country-item list-group-item" ng-repeat="(place, operations) in availPlacesOperations | orderBy: 'place'">
        <a href="" ng-click="selectPlace()">{{place}}</a>
      </li>
      <li class="country-item" ng-if="availPlacesOperations.length == 0">
        <em translate>No active operations found.</em>
      </li>
    </ul>
  </div>

  <div class="active-operations" ng-show="selectedPlace.length && !selectedOperation.length">
    <div class="back-link"><a class="btn btn-warning btn-sm" href="" ng-click="selectedPlace = ''"><i class="fa fa-arrow-circle-left"></i> <span translate>Back</span></a></div>
    <h3 translate>Select an operation</h3>
    <ul class="active-operations-container list-group" ng-repeat="(place, operations) in availPlacesOperations" ng-show="selectedPlace = '{{place}}'" data-place="{{place}}">
      <li class="operation-item list-group-item" ng-repeat="(opid, operation) in operations">
        <a href="" ng-click="selectedOperation = '{{opid}}'">{{operation.name}}</a>
      </li>
    </ul>
  </div>

  <div class="update-profile" ng-show="selectedPlace.length && selectedOperation.length">
    <div class="back-link"><a class="btn btn-warning btn-sm" href="#/dashboard"><i class="fa fa-arrow-circle-left"></i> <span translate>Back</span></a></div>
    <h3 translate>{{profileName}} Profile</h3>
    <div class="profile-form-wrapper">
      <form class="profile-form form-horizontal">
        <div class="form-group">
          <label class="control-label" for="nameGiven" translate>Given Name</label>
          <div class="col-sm-12">
            <input class="form-control" type="text" name="nameGiven" ng-model="profile.nameGiven" />
          </div>
        </div>
        <div class="form-group">
          <label class="control-label" for="nameFamily" translate>Family Name</label>
          <div class="col-sm-12">
            <input class="form-control" type="text" name="nameFamily" ng-model="profile.nameFamily" />
          </div>
        </div>
        <div class="form-group">
          <h4 translate>Organizational Information</h4>
          <label class="control-label" for="jobtitle" translate>Title</label>
          <div class="col-sm-12">
            <input class="form-control" type="text" name="jobtitle" ng-model="profile.jobtitle" />
          </div>
        </div>
        <div class="form-group">
          <label class="control-label" for="organization[0][name]" translate>Organization</label>
          <div class="col-sm-12">
            <angucomplete-alt
              id="organization"
              placeholder="{{'Search for organizations'|translate}}"
              pause="100"
              selected-object="setOrganization"
              remote-url-response-formatter="formatOrganizations"
              remote-url="{{hrinfoBaseUrl}}/hid/organizations/autocomplete/"
              search-fields="name"
              title-field="name"
              minlength="2"
              text-searching="{{'Searching...'|translate}}"
              text-no-results="{{'No results found.'|translate}}"
              initial-value="{{profile.organization[0].name}}"
              input-class="form-control"></angucomplete-alt>
          </div>
        </div>
        <div class="form-group reveal" ng-repeat="bundle in profile.bundle track by $index" ng-if="profile.type === 'local'">
          <label class="control-label" for="bundle[{{$index}}]" translate>Group</label>
          <div class="col-sm-12">
            <select class="form-control" name="bundle[{{$index}}]" ng-model="profile.bundle[$index]" ng-options="bundleName for (bundleId, bundleName) in placesOperations[selectedPlace][selectedOperation].bundles" ng-change="checkMultiFields()">
              <option value=""></option>
            </select>
          </div>
        </div>

        <div class="form-group container operations" ng-show="userIsAdmin">
          <h4 translate>Local Administration</h4>
          <div class="row">
            <label class="control-label" for="keyContact" translate>Key Contact</label>
            <div class="col-sm-12">
              <input type="checkbox" class="form-control" name="keyContact" ng-model="profile.keyContact" />
            </div>
          </div>
        </div>

        <div class="form-group container operations" ng-show="userIsAdmin">
          <h4 translate>Global Administration</h4>
          <div class="row">
            <label class="control-label" for="adminRoles" translate>Admin Privileges</label>
            <div class="col-sm-12">
              <select class="form-control" name="adminRoles" multiple ng-model="adminRoles" ng-options="adminRoleOption for adminRoleOption in adminRoleOptions">
                <option value=""></option>
              </select>
            </div>
          </div>
          <div class="row">
            <label class="control-label" for="verified" translate>Verified Responder</label>
            <div class="col-sm-12">
              <input type="checkbox" class="form-control" name="verified" ng-model="verified" />
            </div>
          </div>
        </div>

        <div class="form-group container">
          <h4 translate>Phone Numbers</h4>
          <div class="reveal" ng-repeat="phone in profile.phone track by $index">
            <div class="row">
              <div class="col-sm-4">
                <label class="control-label" for="phone[{{$index}}][type]" translate>Type</label>
                <select class="form-control" ng-options="type for type in phoneTypes" name="phone[{{$index}}][type]" ng-model="profile.phone[$index].type">
                  <option value="">-- <span translate>Choose Type</span> --</option>
                </select>
              </div>

              <div class="col-sm-4">
                <label class="control-label" for="phone[{{$index}}][number]" translate>Number</label>
                <input ng-if="phone.type != 'Satellite'" ng-model="profile.phone[$index].number" international-phone-number auto-format="true" national-mode="false" responsive-dropdown="true" class="form-control" type="text" name="phone[{{$index}}][number]" ng-change="setCountryCode(); checkMultiFields()" />
                <input ng-if="phone.type == 'Satellite'" ng-model="profile.phone[$index].number" class="form-control" type="text" name="phone[{{$index}}][number]" ng-change="checkMultiFields()" />
                <input type="hidden" name="phone[{{$index}}][countryCode]" ng-model="profile.phone[$index].countryCode" />
              </div>
            </div>
          </div>
        </div>

        <div class="form-group container">
          <h4 translate>Email Addresses</h4>
          <div class="reveal" ng-repeat="email in profile.email track by $index">
            <div class="row">
              <div class="col-sm-4">
                <label class="control-label" for="email[{{$index}}][type]" translate>Type</label>
                <select class="form-control" ng-options="type for type in emailTypes" name="email[{{$index}}][type]" ng-model="profile.email[$index].type">
                  <option value="">-- <span translate>Choose Type</span> --</option>
                </select>
              </div>

              <div class="col-sm-4">
                <label class="control-label" for="email[{{$index}}][address]" translate>Email</label>
                <input class="form-control" type="text" name="email[{{$index}}][address]" ng-model="profile.email[$index].address" ng-change="checkMultiFields()" />
              </div>
            </div>
          </div>
        </div>

        <div class="form-group container">
          <h4 translate>VOIP</h4>
          <div class="reveal" ng-repeat="voip in profile.voip track by $index">
            <div class="row">
              <div class="col-sm-4">
                <label class="control-label" for="voip[{{$index}}][desc]" translate>Type</label>
                <input class="form-control" type="text" name="voip[{{$index}}][type]" ng-model="profile.voip[$index].type" />
              </div>

              <div class="col-sm-4">
                <label class="control-label" for="voip[{{$index}}][number]" translate>VOIP</label>
                <input class="form-control" type="text" name="voip[{{$index}}][number]" ng-model="profile.voip[$index].number" ng-change="checkMultiFields()" />
              </div>
            </div>
          </div>
        </div>

        <div class="form-group">
          <h4 translate>Location</h4>
          <label class="control-label" for="address[0][country]" translate>Country</label>
          <div class="col-sm-12">
            <angucomplete-alt
              id="country"
              placeholder="{{'Search for countries'|translate}}"
              pause="100"
              selected-object="setCountry"
              local-data="countries"
              search-fields="name"
              title-field="name"
              minlength="2"
              text-searching="{{'Searching...'|translate}}"
              text-no-results="{{'No results found.'|translate}}"
              initial-value="{{profile.address[0].country}}"
              input-class="form-control"></angucomplete-alt>
          </div>
        </div>

        <div cg-busy="regionsPromise">
          <div class="form-group reveal" ng-show="regions.length == 0">
            <div class="col-sm-12 col-sm-offset-2">
              <span class="form-control-static alert alert-info" role="alert" translate>We are not currently taking note of administrative areas or localities in this country.</span>
            </div>
          </div>
          <div class="form-group reveal" ng-show="profile.address[0].country && regions.length">
            <label class="control-label" for="address[0][administrative_area]" translate>State/Province/Region</label>
            <div class="col-sm-12">
              <angucomplete-alt
                id="admin_area"
                pause="0"
                selected-object="setAdminArea"
                local-data="regions"
                search-fields="name"
                title-field="name"
                minlength="1"
                text-searching="{{'Searching...'|translate}}"
                text-no-results="{{'No results found.'|translate}}"
                initial-value="{{profile.address[0].administrative_area}}"
                input-class="form-control"></angucomplete-alt>
            </div>
          </div>
        </div>

        <div class="form-group reveal" ng-show="profile.address[0].country && regions.length && profile.address[0].administrative_area">
          <label class="control-label" for="address[0][locality]" translate>City</label>
          <div class="col-sm-12">
            <angucomplete-alt
              id="locality"
              pause="0"
              selected-object="setLocality"
              local-data="localities"
              search-fields="name"
              title-field="name"
              minlength="1"
              text-searching="{{'Searching...'|translate}}"
              text-no-results="{{'No results found.'|translate}}"
              initial-value="{{profile.address[0].locality}}"
              input-class="form-control"></angucomplete-alt>
          </div>
          </div>
        </div>


        <div class="form-group">
          <h4 translate>Websites &amp; Social Media</h4>
          <div class="reveal" ng-repeat="uri in profile.uri track by $index">
            <label class="control-label" for="uri[{{$index}}]" translate>URL</label>
            <div class="col-sm-12">
              <input class="form-control" type="text" name="uri[{{$index}}]" ng-model="profile.uri[$index]" ng-change="checkMultiFields()" />
            </div>
          </div>
        </div>

        <div class="form-group">
          <h4 translate>Notes</h4>
          <label class="control-label" for="notes" translate>Notes</label>
          <div class="col-sm-12">
            <textarea class="form-control" name="notes" ng-model="profile.notes" rows="2"></textarea>
          </div>
        </div>

        <input class="btn btn-primary btn-lg" type="submit" ng-click="submitProfile()" value="{{submitText}}" />
      </form>
    </div>
  </div>
</div>

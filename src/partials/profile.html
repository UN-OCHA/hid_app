<div class="masthead">
  <h2 translate>Humanitarian ID</h2>
</div>

<div ng-show="!isRouteLoading">
  <div class="row">
    <div class="active-countries col-xs-10 col-xs-offset-1 col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3" ng-hide="selectedPlace.length">
      <div class="back-link"><a class="btn btn-warning btn-sm" href="#/dashboard"><i class="fa fa-arrow-circle-left"></i> <span translate>Back</span></a></div>
      <h3 translate>Select a country</h3>
      <ul class="active-countries-container list-group">
        <li class="country-item list-group-item" ng-repeat="(pKey, place) in availPlacesOperations | orderBy: 'place'">
          <a href="" ng-click="selectPlace()">{{place.place}}</a>
        </li>
        <li class="country-item" ng-if="availPlacesOperations.length == 0">
          <em translate>No active operations found.</em>
        </li>
      </ul>
    </div>

    <div class="active-operations" ng-show="selectedPlace.length && !selectedOperation.length">
      <div class="back-link"><a class="btn btn-warning btn-sm" href="" ng-click="selectedPlace = ''"><i class="fa fa-arrow-circle-left"></i> <span translate>Back</span></a></div>
      <h3 translate>Select an operation</h3>
      <ul class="active-operations-container list-group" ng-repeat="(pKey, place) in availPlacesOperations" ng-show="selectedPlace = '{{place.place}}'" data-place="{{place.place}}">
        <li class="operation-item list-group-item" ng-repeat="(opid, operation) in place.operations">
          <a href="" ng-click="selectedOperation = '{{opid}}'">{{operation.name}}</a>
        </li>
      </ul>
    </div>
  </div>


  <form class="update-profile profile-form row" ng-show="selectedPlace.length && selectedOperation.length">
    <div class="form-content col-xs-12 col-sm-8 col-md-9 pull-right" >
      <h3 translate>{{profileName}} Profile</h3>

      <div class="row">
        <div class="col-sm-12 col-md-6">
          <div class="form-group">
            <label class="control-label" for="nameGiven" translate>Given Name</label>
            <input class="form-control" type="text" name="nameGiven" ng-model="profile.nameGiven" />
          </div>
          <div class="form-group">
            <label class="control-label" for="nameFamily" translate>Family Name</label>
            <input class="form-control" type="text" name="nameFamily" ng-model="profile.nameFamily" />
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-sm-12 col-md-6">
          <h4 translate>Organizational Information</h4>
          <div class="form-group">
            <label class="control-label" for="organization[0][name]" translate>Organization</label>
            <angucomplete-alt
              id="organization"
              placeholder="{{'Search for organizations'|translate}}"
              pause="100"
              selected-object="setOrganization"
              remote-url-response-formatter="formatOrganizations"
              remote-url="{{hrinfoBaseUrl}}/hid/organizations/autocomplete/"
              search-fields="name"
              title-field="name"
              minlength="2"
              text-searching="{{'Searching...'|translate}}"
              text-no-results="{{'No results found.'|translate}}"
              initial-value="{{profile.organization[0].name}}"
              input-class="form-control"></angucomplete-alt>
          </div>

          <div class="form-group">
            <label class="control-label" for="jobtitle" translate>Title</label>
            <input class="form-control" type="text" name="jobtitle" ng-model="profile.jobtitle" />
          </div>

          <div class="form-group reveal" ng-repeat="bundle in profile.bundle track by $index" ng-if="profile.type === 'local'">
            <label class="control-label" for="bundle[{{$index}}]" translate>Group</label>
            <select class="form-control" name="bundle[{{$index}}]" ng-model="profile.bundle[$index]" ng-options="bundleName for (bundleId, bundleName) in placesOperations[selectedPlace][selectedOperation].bundles" ng-change="checkMultiFields()">
              <option value=""></option>
            </select>
          </div>
        </div>

        <div class="col-sm-12 col-md-6">
          <h4 translate>Location</h4>
          <div class="form-group">
            <label class="control-label" for="address[0][country]" translate>Country</label>
            <angucomplete-alt
              id="country"
              placeholder="{{'Search for countries'|translate}}"
              pause="100"
              selected-object="setCountry"
              local-data="countries"
              search-fields="name"
              title-field="name"
              minlength="2"
              text-searching="{{'Searching...'|translate}}"
              text-no-results="{{'No results found.'|translate}}"
              initial-value="{{profile.address[0].country}}"
              input-class="form-control"></angucomplete-alt>
          </div>

          <div cg-busy="regionsPromise">
            <div class="form-group reveal" ng-show="regions.length == 0">
              <span class="form-control-static alert alert-info" role="alert" translate>We are not currently taking note of administrative areas or localities in this country.</span>
            </div>
            <div class="form-group reveal" ng-show="profile.address[0].country && regions.length">
              <label class="control-label" for="address[0][administrative_area]" translate>State/Province/Region</label>
              <angucomplete-alt
                id="admin_area"
                pause="0"
                selected-object="setAdminArea"
                local-data="regions"
                search-fields="name"
                title-field="name"
                minlength="1"
                text-searching="{{'Searching...'|translate}}"
                text-no-results="{{'No results found.'|translate}}"
                initial-value="{{profile.address[0].administrative_area}}"
                input-class="form-control"></angucomplete-alt>
            </div>
          </div>

          <div class="form-group reveal" ng-show="profile.address[0].country && regions.length && profile.address[0].administrative_area">
            <label class="control-label" for="address[0][locality]" translate>City</label>
            <angucomplete-alt
              id="locality"
              pause="0"
              selected-object="setLocality"
              local-data="localities"
              search-fields="name"
              title-field="name"
              minlength="1"
              text-searching="{{'Searching...'|translate}}"
              text-no-results="{{'No results found.'|translate}}"
              initial-value="{{profile.address[0].locality}}"
              input-class="form-control"></angucomplete-alt>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-sm-12 col-md-6">
          <h4 translate>Phone Numbers</h4>
          <div class="form-group">
            <div class="row">
              <div class="col-xs-5"><label class="control-label" translate>Type</label></div>
              <div class="col-xs-7"><label class="control-label" translate>Number</label></div>
            </div>
            <div class="reveal" ng-repeat="phone in profile.phone track by $index">
              <div class="row form-elements-phone">
                <div class="col-xs-5">
                  <select class="form-control" ng-options="type for type in phoneTypes" name="phone[{{$index}}][type]" ng-model="profile.phone[$index].type">
                    <option value=""><span translate>Choose Type</span></option>
                  </select>
                </div>

                <div class="col-xs-7">
                  <input ng-if="phone.type != 'Satellite'" ng-model="profile.phone[$index].number" international-phone-number auto-format="true" national-mode="false" responsive-dropdown="true" class="form-control" type="text" name="phone[{{$index}}][number]" ng-change="setCountryCode(); checkMultiFields()" />
                  <input ng-if="phone.type == 'Satellite'" ng-model="profile.phone[$index].number" class="form-control" type="text" name="phone[{{$index}}][number]" ng-change="checkMultiFields()" />
                  <input type="hidden" name="phone[{{$index}}][countryCode]" ng-model="profile.phone[$index].countryCode" />
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-sm-12 col-md-6">
          <h4 translate>VOIP</h4>
          <div class="form-group">
            <div class="row">
              <div class="col-xs-5"><label class="control-label" translate>Type</label></div>
              <div class="col-xs-7"><label class="control-label" translate>VOIP</label></div>
            </div>
            <div class="reveal" ng-repeat="voip in profile.voip track by $index">
              <div class="row form-elements-voip">
                <div class="col-xs-5">
                  <input class="form-control" placeholder="Type" type="text" name="voip[{{$index}}][type]" ng-model="profile.voip[$index].type" />
                </div>
                <div class="col-xs-7">
                  <input class="form-control" placeholder="VOIP" type="text" name="voip[{{$index}}][number]" ng-model="profile.voip[$index].number" ng-change="checkMultiFields()" />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-sm-12 col-md-6">
          <h4 translate>Email Addresses</h4>
          <div class="form-group">
            <div class="row">
              <div class="col-xs-5"><label class="control-label" translate>Type</label></div>
              <div class="col-xs-7"><label class="control-label" translate>Email</label></div>
            </div>
            <div class="reveal" ng-repeat="email in profile.email track by $index">
              <div class="row form-elements-email">
                <div class="col-xs-5">
                  <select class="form-control" ng-options="type for type in emailTypes" name="email[{{$index}}][type]" ng-model="profile.email[$index].type">
                    <option value=""><span translate>Choose Type</span></option>
                  </select>
                </div>
                <div class="col-xs-7">
                  <input class="form-control" placeholder="Address" type="text"  name="email[{{$index}}][address]" ng-model="profile.email[$index].address" ng-change="checkMultiFields()" />
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-sm-12 col-md-6">
          <h4 translate>Websites &amp; Social Media</h4>
          <div class="form-group">
            <div class="reveal" ng-repeat="uri in profile.uri track by $index">
              <label class="control-label" for="uri[{{$index}}]" translate>URL</label>
              <input class="form-control" type="text" name="uri[{{$index}}]" ng-model="profile.uri[$index]" ng-change="checkMultiFields()" />
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-sm-12">
          <h4 translate>Notes</h4>
          <div class="form-group">
            <label class="control-label" for="notes" translate>Notes</label>
            <textarea class="form-control" name="notes" ng-model="profile.notes" rows="2"></textarea>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-sm-12  col-md-6 operations" ng-show="!userIsAdmin">
          <h4 translate>Local Administration</h4>
          <div class="checkbox">
            <label for="keyContact" translate><input type="checkbox" name="keyContact" ng-model="profile.keyContact" />Key Contact</label>
          </div>
        </div>

        <div class="col-sm-12  col-md-6 operations" ng-show="!userIsAdmin">
          <h4 translate>Global Administration</h4>
          <div class="form-group">
            <label class="control-label" for="adminRoles" translate>Admin Privileges</label>
            <select class="form-control" name="adminRoles" multiple ng-model="adminRoles" ng-options="adminRoleOption for adminRoleOption in adminRoleOptions">
              <option value=""></option>
            </select>
          </div>
          <div class="checkbox">
            <label for="verified" translate><input type="checkbox" name="verified" ng-model="verified" />Verified Responder</label>
          </div>
        </div>
      </div>
    </div>

    <div class="sidebar-left" ng-class="{'show-options': profileOptions}">
      <div ng-show="!isRouteLoading">
        <div class="visible-xs">
          <div class="bottom-fixed-btn" role="presentation">
            <a href ng-click="profileOptions = !profileOptions"><div class="bottom-fixed-btn__arrow"></div>Profile Options</a>
          </div>
        </div>
      </div>
      <div class="col-xs-12 col-sm-4 col-md-3 actions-wrapper">
        <div class="actions">
          <a class="btn btn-default btn-lg btn-block" href="{{logoutPath}}" translate>Logout</a>
          <a class="btn btn-default btn-lg btn-block" href="#/dashboard">
            <i class="fa fa-arrow-circle-left"></i> <span translate>Back</span></a>
          </div>
          <input class="btn btn-primary btn-lg btn-block" type="submit" ng-click="submitProfile()" value="{{submitText}}" />
        </div>
      </div>
    </div>
  </form>
</div>
